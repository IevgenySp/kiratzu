/*
 * Copyright 2014-2017 Sergii Filiuk Quasar WebGL SDK & Galaxy Game.
 */
/*!
 * Quasar WebGL SDK & Galaxy Game v1.0.0
 * Sergii Filiuk
 * License and Terms of Use: See http://sergii.filiuk.com/quasar/terms-of-use/
 * http://sergii.filiuk.com/galaxy/terms-of-use/
 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Terrain=e():t.Terrain=e()}(this,function(){return function(t){function __webpack_require__(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,__webpack_require__),i.l=!0,i.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.i=function(t){return t},__webpack_require__.d=function(t,e,n){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=26)}([function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),r=function(){function EventDispatcher(){_classCallCheck(this,EventDispatcher),this.multipleEventsRegExp=new RegExp(/\s/g),this.events=[]}return i(EventDispatcher,[{key:"on",value:function(t,e,n){var i=t.split(","),r=i.entries(),o=!0,s=!1,a=void 0;try{for(var u,c=r[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var h=u.value,f=h[1].replace(this.multipleEventsRegExp,"");this._events.push({name:f,id:n,callback:e})}}catch(t){s=!0,a=t}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}}},{key:"off",value:function(t,e,n){this._events=this._events.filter(function(i,r){return t&&e?!(i.name===t&&i.callback===e):t&&n?!(i.name===t&&i.id===n):i.name!==t})}},{key:"once",value:function(t,e,n){var i=this,r=t.split(","),o=r.entries(),s=!0,a=!1,u=void 0;try{for(var c,h=function(){var t=c.value,r=t[1].replace(i.multipleEventsRegExp,""),o=function(){return this.off(r,o,n),e()}.bind(i);i._events.push({name:r,id:n,callback:o})},f=o[Symbol.iterator]();!(s=(c=f.next()).done);s=!0)h()}catch(t){a=!0,u=t}finally{try{!s&&f.return&&f.return()}finally{if(a)throw u}}}},{key:"trigger",value:function(t){for(var e=this._events.entries(),n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var o=!0,s=!1,a=void 0;try{for(var u,c=e[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var h=u.value,f=h[1];f.name===t&&f.callback.apply(f,[f].concat(i))}}catch(t){s=!0,a=t}finally{try{!o&&c.return&&c.return()}finally{if(s)throw a}}}},{key:"multipleEventsRegExp",set:function(t){this._multipleEventsRegExp=t},get:function(){return this._multipleEventsRegExp}},{key:"events",set:function(t){this._events=t},get:function(){return this._events}}]),EventDispatcher}();e.a=r},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(16),r=n(6),o=n(2),s=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),a=function(){function Matrix(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;if(_classCallCheck(this,Matrix),t instanceof Array)this.obj=t.concat([]);else{this.obj=new Array(t).fill(0);for(var e=Math.sqrt(t),n=0;n<e;n++)this.obj[n*e+n]=1}}return s(Matrix,[{key:"forEach",value:function(t){this.obj.forEach(t.bind(this))}},{key:"reduce",value:function(t,e){return void 0!==e?this.obj.reduce(t.bind(this),e):this.obj.reduce(t.bind(this))}},{key:"fromRotationTranslation",value:function(t,e){var n=new Matrix(16),i=t[0]+t[0],r=t[1]+t[1],o=t[2]+t[2],s=t[0]*i,a=t[0]*r,u=t[0]*o,c=t[1]*r,h=t[1]*o,f=t[2]*o,l=t[3]*i,b=t[3]*r,p=t[3]*o;return n.obj[0]=1-(c+f),n.obj[1]=a+p,n.obj[2]=u-b,n.obj[3]=0,n.obj[4]=a-p,n.obj[5]=1-(s+f),n.obj[6]=h+l,n.obj[7]=0,n.obj[8]=u+b,n.obj[9]=h-l,n.obj[10]=1-(s+c),n.obj[11]=0,n.obj[12]=e[0],n.obj[13]=e[1],n.obj[14]=e[2],n.obj[15]=1,n}},{key:"applyQuaternion",value:function(t){var e=t;t instanceof i.a&&(e=t.obj);var n=e[0],r=e[1],o=e[2],s=e[3],a=[1-r*(r+r)-o*(o+o),r*(n+n)+s*(o+o),o*(n+n)-s*(r+r),0],u=[r*(n+n)-s*(o+o),1-n*(n+n)-o*(o+o),o*(r+r)+s*(n+n),0],c=[o*(n+n)+s*(r+r),o*(r+r)-s*(n+n),1-n*(n+n)-r*(r+r),0],h=[0,0,0,1];if("mat4"===this.type)this.obj=[a[0],a[1],a[2],a[3],u[0],u[1],u[2],u[3],c[0],c[1],c[2],c[3],h[0],h[1],h[2],h[3]];else{if("mat3"!==this.type)throw new Error("Set Matrix from Quaternion availible just for mat4 and mat3");this.obj=[a[0],u[0],c[0],a[1],u[1],c[1],a[2],u[2],c[2]]}return this}},{key:"scale",value:function(t){var e=new Matrix(this.size);return e.obj[0]=this.obj[0]*t[0],e.obj[1]=this.obj[1]*t[0],e.obj[2]=this.obj[2]*t[0],e.obj[3]=this.obj[3]*t[0],e.obj[4]=this.obj[4]*t[1],e.obj[5]=this.obj[5]*t[1],e.obj[6]=this.obj[6]*t[1],e.obj[7]=this.obj[7]*t[1],e.obj[8]=this.obj[8]*t[2],e.obj[9]=this.obj[9]*t[2],e.obj[10]=this.obj[10]*t[2],e.obj[11]=this.obj[11]*t[2],e.obj[12]=this.obj[12],e.obj[13]=this.obj[13],e.obj[14]=this.obj[14],e.obj[15]=this.obj[15],e}},{key:"multiply",value:function(t){var e=new Matrix(this.size);if("mat4"===this.type){var n=this.obj[0],i=this.obj[1],r=this.obj[2],o=this.obj[3],s=this.obj[4],a=this.obj[5],u=this.obj[6],c=this.obj[7],h=this.obj[8],f=this.obj[9],l=this.obj[10],b=this.obj[11],p=this.obj[12],j=this.obj[13],y=this.obj[14],v=this.obj[15],g=t.obj[0],_=t.obj[1],m=t.obj[2],d=t.obj[3];return e.obj[0]=g*n+_*s+m*h+d*p,e.obj[1]=g*i+_*a+m*f+d*j,e.obj[2]=g*r+_*u+m*l+d*y,e.obj[3]=g*o+_*c+m*b+d*v,g=t.obj[4],_=t.obj[5],m=t.obj[6],d=t.obj[7],e.obj[4]=g*n+_*s+m*h+d*p,e.obj[5]=g*i+_*a+m*f+d*j,e.obj[6]=g*r+_*u+m*l+d*y,e.obj[7]=g*o+_*c+m*b+d*v,g=t.obj[8],_=t.obj[9],m=t.obj[10],d=t.obj[11],e.obj[8]=g*n+_*s+m*h+d*p,e.obj[9]=g*i+_*a+m*f+d*j,e.obj[10]=g*r+_*u+m*l+d*y,e.obj[11]=g*o+_*c+m*b+d*v,g=t.obj[12],_=t.obj[13],m=t.obj[14],d=t.obj[15],e.obj[12]=g*n+_*s+m*h+d*p,e.obj[13]=g*i+_*a+m*f+d*j,e.obj[14]=g*r+_*u+m*l+d*y,e.obj[15]=g*o+_*c+m*b+d*v,e}return this}},{key:"lookAt",value:function(t,e,n){if("mat4"!==this.type)throw new Error("lookAt availible just for mat4");var i=new Matrix,r=void 0,o=t,s=e,a=n,u=new Array(3).fill(0),c=new Array(3).fill(0),h=new Array(3).fill(0);return u[2]=o[0]-s[0],c[2]=o[1]-s[1],h[2]=o[2]-s[2],Math.abs(u[2])<1e-15&&Math.abs(c[2])<1e-15&&Math.abs(h[2])<1e-15?i:(r=1/Math.sqrt(Math.pow(u[2],2)+Math.pow(c[2],2)+Math.pow(h[2],2)),u[2]*=r,c[2]*=r,h[2]*=r,u[0]=a[1]*h[2]-a[2]*c[2],c[0]=a[2]*u[2]-a[0]*h[2],h[0]=a[0]*c[2]-a[1]*u[2],r=Math.sqrt(Math.pow(u[0],2)+Math.pow(c[0],2)+Math.pow(h[0],2)),r?(r=1/r,u[0]*=r,c[0]*=r,h[0]*=r):(u[0]=0,c[0]=0,h[0]=0),u[1]=c[2]*h[0]-h[2]*c[0],c[1]=h[2]*u[0]-u[2]*h[0],h[1]=u[2]*c[0]-c[2]*u[0],r=Math.sqrt(Math.pow(u[1],2)+Math.pow(c[1],2)+Math.pow(h[1],2)),r?(r=1/r,u[1]*=r,c[1]*=r,h[1]*=r):(u[1]=0,c[1]=0,h[1]=0),i.obj[0]=u[0],i.obj[1]=u[1],i.obj[2]=u[2],i.obj[3]=0,i.obj[4]=c[0],i.obj[5]=c[1],i.obj[6]=c[2],i.obj[7]=0,i.obj[8]=h[0],i.obj[9]=h[1],i.obj[10]=h[2],i.obj[11]=0,i.obj[12]=-(u[0]*o[0]+c[0]*o[1]+h[0]*o[2]),i.obj[13]=-(u[1]*o[0]+c[1]*o[1]+h[1]*o[2]),i.obj[14]=-(u[2]*o[0]+c[2]*o[1]+h[2]*o[2]),i.obj[15]=1,i)}},{key:"inverse",value:function(){var t=new Matrix(this.size);if("mat4"===this.type){var e=new Array(4).fill(0),n=new Array(4).fill(0),i=new Array(4).fill(0);e[0]=this.obj[0]*this.obj[5]-this.obj[1]*this.obj[4],e[1]=this.obj[0]*this.obj[6]-this.obj[2]*this.obj[4],e[2]=this.obj[0]*this.obj[7]-this.obj[3]*this.obj[4],e[3]=this.obj[1]*this.obj[6]-this.obj[2]*this.obj[5],n[0]=this.obj[1]*this.obj[7]-this.obj[3]*this.obj[5],n[1]=this.obj[2]*this.obj[7]-this.obj[3]*this.obj[6],n[2]=this.obj[8]*this.obj[13]-this.obj[9]*this.obj[12],n[3]=this.obj[8]*this.obj[14]-this.obj[10]*this.obj[12],i[0]=this.obj[8]*this.obj[15]-this.obj[11]*this.obj[12],i[1]=this.obj[9]*this.obj[14]-this.obj[10]*this.obj[13],i[2]=this.obj[9]*this.obj[15]-this.obj[11]*this.obj[13],i[3]=this.obj[10]*this.obj[15]-this.obj[11]*this.obj[14];var r=e[0]*i[3]-e[1]*i[2]+e[2]*i[1]+e[3]*i[0]-n[0]*n[3]+n[1]*n[2];if(!r)return t;r=1/r,t.obj[0]=(this.obj[5]*i[3]-this.obj[6]*i[2]+this.obj[7]*i[1])*r,t.obj[1]=(this.obj[2]*i[2]-this.obj[1]*i[3]-this.obj[3]*i[1])*r,t.obj[2]=(this.obj[13]*n[1]-this.obj[14]*n[0]+this.obj[15]*e[3])*r,t.obj[3]=(this.obj[10]*n[0]-this.obj[9]*n[1]-this.obj[11]*e[3])*r,t.obj[4]=(this.obj[6]*i[0]-this.obj[4]*i[3]-this.obj[7]*n[3])*r,t.obj[5]=(this.obj[0]*i[3]-this.obj[2]*i[0]+this.obj[3]*n[3])*r,t.obj[6]=(this.obj[14]*e[2]-this.obj[12]*n[1]-this.obj[15]*e[1])*r,t.obj[7]=(this.obj[8]*n[1]-this.obj[10]*e[2]+this.obj[11]*e[1])*r,t.obj[8]=(this.obj[4]*i[2]-this.obj[5]*i[0]+this.obj[7]*n[2])*r,t.obj[9]=(this.obj[1]*i[0]-this.obj[0]*i[2]-this.obj[3]*n[2])*r,t.obj[10]=(this.obj[12]*n[0]-this.obj[13]*e[2]+this.obj[15]*e[0])*r,t.obj[11]=(this.obj[9]*e[2]-this.obj[8]*n[0]-this.obj[11]*e[0])*r,t.obj[12]=(this.obj[5]*n[3]-this.obj[4]*i[1]-this.obj[6]*n[2])*r,t.obj[13]=(this.obj[0]*i[1]-this.obj[1]*n[3]+this.obj[2]*n[2])*r,t.obj[14]=(this.obj[13]*e[1]-this.obj[12]*e[3]-this.obj[14]*e[0])*r,t.obj[15]=(this.obj[8]*e[3]-this.obj[9]*e[1]+this.obj[10]*e[0])*r}else{if("mat3"!==this.type)throw new Error("inverse availible just for mat4 and mat3");var o=new Array(3).fill(0);o[0]=this.obj[8]*this.obj[4]-this.obj[5]*this.obj[7],o[1]=-this.obj[8]*this.obj[3]+this.obj[5]*this.obj[6],o[2]=this.obj[7]*this.obj[3]-this.obj[4]*this.obj[6];var s=this.obj[0]*o[0]+this.obj[1]*o[1]+this.obj[2]*o[2];if(!s)return t;s=1/s,t.obj[0]=o[0]*s,t.obj[1]=(-this.obj[8]*this.obj[1]+this.obj[2]*this.obj[7])*s,t.obj[2]=(this.obj[5]*this.obj[1]-this.obj[2]*this.obj[4])*s,t.obj[3]=o[1]*s,t.obj[4]=(this.obj[8]*this.obj[0]-this.obj[2]*this.obj[6])*s,t.obj[5]=(-this.obj[5]*this.obj[0]+this.obj[2]*this.obj[3])*s,t.obj[6]=o[2]*s,t.obj[7]=(-this.obj[7]*this.obj[0]+this.obj[1]*this.obj[6])*s,t.obj[8]=(this.obj[4]*this.obj[0]-this.obj[1]*this.obj[3])*s}return t}},{key:"getRow",value:function(t){for(var e=Math.sqrt(this.size),n=new r.a(e),i=0;i<e;i++)for(var o=0;o<e;o++)t===i&&(n.obj[o]=this.obj[i*e+o]);return n}},{key:"getColumn",value:function(t){for(var e=Math.sqrt(this.size),n=new r.a(e),i=0;i<e;i++)for(var o=0;o<e;o++)t===o&&(n.obj[i]=this.obj[i*e+o]);return n}},{key:"setRow",value:function(t,e){for(var n=Math.sqrt(this.size),i=0;i<n;i++)for(var r=0;r<n;r++)t===i&&e[r]&&(this.obj[i*n+r]=e[r]);return this}},{key:"setColumn",value:function(t,e){for(var n=Math.sqrt(this.size),i=0;i<n;i++)for(var r=0;r<n;r++)t===r&&(this.obj[i*n+r]=e[r]);return this}},{key:"frustum",value:function(){}},{key:"perspective",value:function(t,e,n,i){var r=new Matrix(16);return r.obj[0]=1/Math.tan(t/2)/e,r.obj[1]=0,r.obj[2]=0,r.obj[3]=0,r.obj[4]=0,r.obj[5]=1/Math.tan(t/2),r.obj[6]=0,r.obj[7]=0,r.obj[8]=0,r.obj[9]=0,r.obj[10]=(i+n)*(1/(n-i)),r.obj[11]=-1,r.obj[12]=0,r.obj[13]=0,r.obj[14]=2*i*n*(1/(n-i)),r.obj[15]=0,r}},{key:"ortho",value:function(t,e,n,i,r,o){return this.obj[0]=1/(t-e)*-2,this.obj[1]=0,this.obj[2]=0,this.obj[3]=0,this.obj[4]=0,this.obj[5]=1/(n-i)*-2,this.obj[6]=0,this.obj[7]=0,this.obj[8]=0,this.obj[9]=0,this.obj[10]=1/(r-o)*2,this.obj[11]=0,this.obj[12]=(t+e)*(1/(t-e)),this.obj[13]=(i+n)*(1/(n-i)),this.obj[14]=(o+r)*(1/(r-o)),this.obj[15]=1,this}},{key:"transpose",value:function(){var t=new Matrix(this.size);return t.obj[0]=this.obj[0],t.obj[1]=this.obj[4],t.obj[2]=this.obj[8],t.obj[3]=this.obj[12],t.obj[4]=this.obj[1],t.obj[5]=this.obj[5],t.obj[6]=this.obj[9],t.obj[7]=this.obj[13],t.obj[8]=this.obj[2],t.obj[9]=this.obj[6],t.obj[10]=this.obj[10],t.obj[11]=this.obj[14],t.obj[12]=this.obj[3],t.obj[13]=this.obj[7],t.obj[14]=this.obj[11],t.obj[15]=this.obj[15],t}},{key:"translate",value:function(t){if(t instanceof r.a&&(t=t.obj),!(t instanceof Array))throw new Error("Input position value not compatible format");var e=new Matrix(this.obj);return"mat4"===this.type?(e.obj[12]=e.obj[0]*t[0]+e.obj[4]*t[1]+e.obj[8]*t[2]+e.obj[12],e.obj[13]=e.obj[1]*t[0]+e.obj[5]*t[1]+e.obj[9]*t[2]+e.obj[13],e.obj[14]=e.obj[2]*t[0]+e.obj[6]*t[1]+e.obj[10]*t[2]+e.obj[14],e.obj[15]=e.obj[3]*t[0]+e.obj[7]*t[1]+e.obj[11]*t[2]+e.obj[15]):"mat3"===this.type?(e.obj[6]=e.obj[0]*t[0]+e.obj[3]*t[1]+e.obj[6],e.obj[7]=e.obj[1]*t[0]+e.obj[4]*t[1]+e.obj[7],e.obj[8]=e.obj[2]*t[0]+e.obj[5]*t[1]+e.obj[8]):6===this.size&&(e.obj[4]=e.obj[0]*t[0]+e.obj[2]*t[1]+e.obj[4],e.obj[5]=e.obj[1]*t[0]+e.obj[3]*t[1]+e.obj[5]),e}},{key:"scale",value:function(t){if(t instanceof r.a&&(t=t.obj),!(t instanceof Array))throw new Error("Input scale value not compatible format");var e=new Matrix(this.obj);return"mat4"===this.type?(e.obj[0]=e.obj[0]*t[0],e.obj[1]=e.obj[1]*t[0],e.obj[2]=e.obj[2]*t[0],e.obj[3]=e.obj[3]*t[0],e.obj[4]=e.obj[4]*t[1],e.obj[5]=e.obj[5]*t[1],e.obj[6]=e.obj[6]*t[1],e.obj[7]=e.obj[7]*t[1],e.obj[8]=e.obj[8]*t[2],e.obj[9]=e.obj[9]*t[2],e.obj[10]=e.obj[10]*t[2],e.obj[11]=e.obj[11]*t[2],e.obj[12]=e.obj[12],e.obj[13]=e.obj[13],e.obj[14]=e.obj[14],e.obj[15]=e.obj[15]):"mat3"===this.type?(e.obj[0]=e.obj[0]*t[0],e.obj[1]=e.obj[1]*t[0],e.obj[2]=e.obj[2]*t[0],e.obj[3]=e.obj[3]*t[1],e.obj[4]=e.obj[4]*t[1],e.obj[5]=e.obj[5]*t[1],e.obj[6]=e.obj[6],e.obj[7]=e.obj[7],e.obj[8]=e.obj[8]):6===this.size&&(e.obj[0]=e.obj[0]*t[0],e.obj[1]=e.obj[1]*t[0],e.obj[2]=e.obj[2]*t[1],e.obj[3]=e.obj[3]*t[1],e.obj[4]=e.obj[4],e.obj[5]=e.obj[5]),e}},{key:"rotate",value:function(t){var e=t.map(function(t){return o.a.rad(t)}),n=new i.a,r=new i.a,s=new i.a;r=r.setAxisAngle([1,0,0],e[0]),n=n.setAxisAngle([0,1,0],e[1]),s=s.setAxisAngle([0,0,1],e[2]);var a=n.multiply(r).multiply(s).normalize(),u=new Matrix(this.size);return u.applyQuaternion(a),this.multiply(u)}},{key:"rotateX",value:function(t){}},{key:"rotateY",value:function(t){}},{key:"rotateZ",value:function(t){}},{key:"makeRotationFromQuaternion",value:function(t){var e=new Matrix(16),n=e.obj,i=t[0],r=t[1],o=t[2],s=t[3],a=i+i,u=r+r,c=o+o,h=i*a,f=i*u,l=i*c,b=r*u,p=r*c,j=o*c,y=s*a,v=s*u,g=s*c;return n[0]=1-(b+j),n[4]=f-g,n[8]=l+v,n[1]=f+g,n[5]=1-(h+j),n[9]=p-y,n[2]=l-v,n[6]=p+y,n[10]=1-(h+b),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,e}},{key:"type",get:function(){var t=this.size;return 16===t?"mat4":9===t?"mat3":4===t?"mat2":void 0}},{key:"size",get:function(){return this.obj.length}},{key:"float32",get:function(){return new Float32Array(this.obj)}},{key:"int8",get:function(){return new Int8Array(this.obj)}},{key:"int16",get:function(){return new Int16Array(this.obj)}},{key:"uInt8",get:function(){return new Uint8Array(this.obj)}},{key:"uInt16",get:function(){return new Uint16Array(this.obj)}}]),Matrix}();e.a=a},function(t,e,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r={generateGrid:function(t,e,n){function create2DTrianglesQuad(n,i,r,o){var s=i*o.position.x+r.position.x,f=n*o.position.y+r.position.y,l=i*o.uv.u+r.uv.u,b=n*o.uv.v+r.uv.v,p=s,j=f,y=s+o.position.x,v=f,g=s+o.position.x,_=f+o.position.y,m=s,d=f+o.position.y,w=l,k=b,x=l+o.uv.u,E=b,T=l+o.uv.u,P=b+o.uv.v,C=l,O=b+o.uv.v,M=[p,j,y,v,m,d],S=[g,_,m,d,y,v],A=[w,k,x,E,C,O],R=[T,P,C,O,x,E];return c.push(p,j),h.push(w,k),a["v"+p+"_"+j]=u,u++,i!==t&&n!==e&&{triangles:[{vertices:M,uv:A},{vertices:S,uv:R}]}}for(var i={quads:[]},r=r||1,o={position:{x:-1*r,y:-1*r},uv:{u:0,v:0}},s={position:{x:2*r/t,y:2*r/e},uv:{u:1/t,v:1/e}},a={},u=0,c=[],h=[],f=[],l=0;l<e+1;l++)for(var b=0;b<t+1;b++){var p=create2DTrianglesQuad(l,b,o,s);p&&i.quads.push(p)}return i.quads.forEach(function(t){t.triangles.forEach(function(t){var e=t.vertices.length;t.indices=[];for(var n=0;n<e;n+=2){var i=a["v"+t.vertices[n]+"_"+t.vertices[n+1]];f.push(i),t.indices.push(i)}})}),i.indices=f,i.vertices=c,i.uv=h,i},max:function(t){return t.reduce(function(t,e){return t>e?t:e})},min:function(t){return t.reduce(function(t,e){return t<e?t:e})},extremums:function(t){var e=null,n=null,i=t.entries(),r=!0,o=!1,s=void 0;try{for(var a,u=i[Symbol.iterator]();!(r=(a=u.next()).done);r=!0){var c=a.value,h=c[1];null===e?e=h:e>h&&(e=h),null===n?n=h:n<h&&(n=h)}}catch(t){o=!0,s=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw s}}return{min:e,max:n}},rad:function(t){return t*Math.PI/180},grad:function(t){return 180*t/Math.PI},valueFromToRange:function(t,e,n,i,r){return(t-n)*(i-r)/(e-n)+r},styleToHTMLStyle:function(t){function stylesLoop(t,n){for(var r in t)"object"===i(t[r])?stylesLoop(t[r],n?n+r.charAt(0).toUpperCase()+r.substr(1):r):e[n?n+r.charAt(0).toUpperCase()+r.substr(1):r]=t[r]}var e={};return stylesLoop(t),e},setHTMLStyle:function(t,e){for(var n in e)t.style[n]=e[n]},isUndefined:function(t){return void 0===t},merge:function(t){function merge(){return t.apply(this,arguments)}return merge.toString=function(){return t.toString()},merge}(function(){for(var t=arguments.length,e=Array(t>1?t-1:0),n=1;n<t;n++)e[n-1]=arguments[n];var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.is(i,null)?{}:e.reduce(function(t,e){return null==e?t:(Object.keys(e).forEach(function(n){var i=e[n];if(!Object.is(i,void 0)){var r=t[n],o=i===Object(i),s=r===Object(r);t[n]=o&&s?merge(r,i):i}}),t)},i)}),hexToRGB:function(t){var e=t||"#cccccc";return e=parseInt(e.replace("#","").toUpperCase(),16),[e>>16,e>>8&255,255&e]}};e.a=r},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(t){function Buffer(t,e,n,i,r,o){_classCallCheck(this,Buffer);var s=_possibleConstructorReturn(this,(Buffer.__proto__||Object.getPrototypeOf(Buffer)).call(this));return s.name=t,s.gl=o,s.drawType=n,s.bufferType=e,s.size=i,s.data=r,o&&s.link(o),s}return _inherits(Buffer,t),r(Buffer,[{key:"init",value:function(){this.context=this.gl.createBuffer()}},{key:"link",value:function(t){return this.gl!==t&&(this.gl=t,this.init(),this.data&&this.use(),this)}},{key:"use",value:function(){this.gl.bindBuffer(this.gl[this.bufferType],this.context),this.gl.bufferData(this.gl[this.bufferType],this.data,this.gl[this.drawType]),this.gl.bindBuffer(this.gl[this.bufferType],null)}},{key:"remove",value:function(){this.gl.removeBuffer(this.context)}},{key:"name",set:function(t){return this._name=t},get:function(){return this._name}},{key:"size",set:function(t){this._size=t},get:function(){return this._size}},{key:"data",set:function(t){this._data=t},get:function(){return this._data}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"drawType",set:function(t){this._drawType=t},get:function(){return this._drawType}},{key:"bufferType",set:function(t){this._bufferType=t},get:function(){return this._bufferType}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}}]),Buffer}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=n(11),o=(n(5),n(2),function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}()),s=function(t){function Display(t){_classCallCheck(this,Display);var e=_possibleConstructorReturn(this,(Display.__proto__||Object.getPrototypeOf(Display)).call(this));return e.name=t,e.programs=new Map,e.extentions=new Map,e.objects=new Map,e.canvas=new r.a,e.gl=e.canvas.gl,e.position={x:0,y:0},e}return _inherits(Display,t),o(Display,[{key:"useProgram",value:function(t){this.program=this.programs.get(t),this.program.use()}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.gl.viewport(this.position.x,this.position.y,this.width,this.height)}},{key:"clear",value:function(){this.gl.enable(this.gl.SCISSOR_TEST),this.gl.scissor(this.position.x,this.position.y,this.width,this.height),this.gl.viewport(this.position.x,this.position.y,this.width,this.height),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.disable(this.gl.SCISSOR_TEST)}},{key:"addProgram",value:function(t,e){this.programs.set(t,e)}},{key:"getProgram",value:function(t){return this.programs.get(t)}},{key:"removeProgram",value:function(t){this.programs.remove(t)}},{key:"addExtention",value:function(t){if(this.extentions.get(t))console.log(t+" not supported");else{this.gl.getSupportedExtensions().indexOf(t)>=0&&this.extentions.set(t,this.gl.getExtension(t))}}},{key:"addObject",value:function(t,e){this.objects.set(t,e)}},{key:"getObject",value:function(t){return this.objects.get(t)}},{key:"removeObjects",value:function(t){this.objects.remove(t)}},{key:"hideObject",value:function(t){return!!this.objects.get(t)&&(this.objects.get(t).options.visible=!1,!0)}},{key:"showObjects",value:function(t){return!!this.objects.get(t)&&(this.objects.get(t).options.visible=!1,!0)}},{key:"link",value:function(t){this.canvas=new r.a,this.canvas.context=t,this.canvas.gl=t.getContext("webgl"),this.gl=this.canvas.gl,this.programs.forEach(function(t){t.link(this.gl)}.bind(this))}},{key:"appendTo",value:function(t){t.appendChild(this.canvas.context)}},{key:"removeFrom",value:function(t){t.removeChild(this.canvas.context)}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"objects",set:function(t){this._objects=t},get:function(){return this._objects}},{key:"position",set:function(t){this._position=t},get:function(){return this._position}},{key:"name",set:function(t){return this._name},get:function(){return this._name}},{key:"programs",get:function(){return this._programs},set:function(t){this._programs=t}},{key:"extentions",get:function(){return this._extentions},set:function(t){this._extentions=t}},{key:"width",set:function(t){this._width=t},get:function(){return this._width}},{key:"height",set:function(t){this._height=t},get:function(){return this._height}},{key:"canvas",set:function(t){this._canvas=t},get:function(){return this._canvas}},{key:"program",set:function(t){this._program=t},get:function(){return this._program}}]),Display}(i.a);e.a=s},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(t){function Program(t,e){_classCallCheck(this,Program);var n=_possibleConstructorReturn(this,(Program.__proto__||Object.getPrototypeOf(Program)).call(this));return n.name=t,n.gl=e,n.uniforms=new Map,n.attributes=new Map,n.shaders=new Map,n}return _inherits(Program,t),r(Program,[{key:"getUniform",value:function(t){return this.uniforms.get(t)}},{key:"getShader",value:function(t){return this.shaders.get(t)}},{key:"getAttribute",value:function(t){return this.attributes.get(t)}},{key:"addAttribute",value:function(t,e){this.attributes.set(t,e)}},{key:"addUniform",value:function(t,e){this.uniforms.set(t,e)}},{key:"addShader",value:function(t,e){this.shaders.set(t,e)}},{key:"removeAttributes",value:function(t){this.attributes.remove(t)}},{key:"removeUniform",value:function(t){this.uniforms.remove(t)}},{key:"removeShader",value:function(t){this.uniforms.remove(t)}},{key:"init",value:function(){this.context=this.gl.createProgram()}},{key:"link",value:function(t){if(this.gl===t)return!1;this.gl=t,this.init(),this.shaders.forEach(function(t){t.link(this.gl,this)}.bind(this)),this.useShaders("vs","fs"),this.uniforms.forEach(function(t){t.link(this.gl,this)}.bind(this)),this.attributes.forEach(function(t){t.link(this.gl,this)}.bind(this))}},{key:"remove",value:function(){this.gl.deleteProgram(this.context)}},{key:"use",value:function(){this.gl.getParameter(this.gl.CURRENT_PROGRAM)!==this.context&&this.gl.useProgram(this.context)}},{key:"useShaders",value:function(t,e){this.gl.attachShader(this.context,this.shaders.get(t).context),this.gl.attachShader(this.context,this.shaders.get(e).context),this.gl.linkProgram(this.context)}},{key:"name",set:function(t){return this._name=t},get:function(){return this._name}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"uniforms",set:function(t){this._uniforms=t},get:function(){return this._uniforms}},{key:"attributes",set:function(t){this._attributes=t},get:function(){return this._attributes}},{key:"shaders",set:function(t){this._shaders=t},get:function(){return this._shaders}}]),Program}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(1),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(){function Vector(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;_classCallCheck(this,Vector),this.obj=t instanceof Array?t.concat([]):new Array(t).fill(0)}return r(Vector,[{key:"applyQuaternion",value:function(t){if(this.size<=2)throw new Error(this.type+"can't be transformed by quaternion this type not compatible type");var e=[t[3]*this.obj[0]+t[1]*this.obj[2]-t[2]*this.obj[1],t[3]*this.obj[1]+t[2]*this.obj[0]-t[0]*this.obj[2],t[3]*this.obj[2]+t[0]*this.obj[1]-t[1]*this.obj[0],-t[0]*this.obj[0]-t[1]*this.obj[1]-t[2]*this.obj[2]];return this.obj[0]=e[0]*t[3]+e[3]*-t[0]+e[1]*-t[2]-e[2]*-t[1],this.obj[1]=e[1]*t[3]+e[3]*-t[1]+e[2]*-t[0]-e[0]*-t[2],this.obj[2]=e[2]*t[3]+e[3]*-t[2]+e[0]*-t[1]-e[1]*-t[0],4===this.size&&(this.obj[3]=this.obj[3]),this}},{key:"forEach",value:function(t){this.obj.forEach(t.bind(this))}},{key:"map",value:function(t){return this.obj.map(t.bind(this))}},{key:"filter",value:function(t){return this.obj.filter(t.bind(this))}},{key:"reduce",value:function(t,e){return void 0!==e?this.obj.reduce(t.bind(this),e):this.obj.reduce(t.bind(this))}},{key:"cross",value:function(t){var e=new Vector(this.size),n=t;if(n instanceof Vector&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be cross calculate with not compatible type");e.obj[0]=this.obj[1]*n[2]-this.obj[2]*n[1],e.obj[1]=this.obj[2]*n[0]-this.obj[0]*n[2],e.obj[2]=this.obj[0]*n[1]-this.obj[1]*n[0]}return e}},{key:"transformMat4",value:function(t){var e=new Vector(this.size),n=t,i=n.obj[3]*this.obj[0]+n.obj[7]*this.obj[1]+n.obj[11]*this.obj[2]+n.obj[15];return i=i||1,e.obj[0]=(n.obj[0]*this.obj[0]+n.obj[4]*this.obj[1]+n.obj[8]*this.obj[2]+n.obj[12])/i,e.obj[1]=(n.obj[1]*this.obj[0]+n.obj[5]*this.obj[1]+n.obj[9]*this.obj[2]+n.obj[13])/i,e.obj[2]=(n.obj[2]*this.obj[0]+n.obj[6]*this.obj[1]+n.obj[10]*this.obj[2]+n.obj[14])/i,e}},{key:"multiply",value:function(t){var e=new Vector(this.size),n=t;if((n instanceof Vector||n instanceof i.a)&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be multiply with not compatible type");if(n.length===this.size)return this.forEach(function(t,i){e.obj[i]=t*n[i]}),e;if(n.length>this.size){for(var r=0;r<this.size;r++)for(var o=0;o<this.size;o++)e.obj[r]+=this.obj[o]*n[r+this.size*o];return e}}else if("number"==typeof n)return this.forEach(function(t,i){e.obj[i]=t*n}),e;return this}},{key:"add",value:function(t){var e=new Vector(this.size),n=t;if(n instanceof Vector&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be add with not compatible type");this.forEach(function(t,i){e.obj[i]=t+n[i]})}else"number"==typeof n&&this.forEach(function(t,i){e.obj[i]=t+n});return e}},{key:"divide",value:function(t){var e=new Vector(this.size),n=t;if(n instanceof Vector&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be divide with not compatible type");this.forEach(function(t,i){e.obj[i]=t+n[i]})}else"number"==typeof n&&this.forEach(function(t,i){e.obj[i]=t/n});return e}},{key:"inverse",value:function(){return new Vector(this.map(function(t){return 1/t}))}},{key:"subtract",value:function(t){var e=new Vector(this.size),n=t;if(n instanceof Vector&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be add with not compatible type");this.forEach(function(t,i){e.obj[i]=t-n[i]})}else"number"==typeof n&&this.forEach(function(t,i){e.obj[i]=t-n});return e}},{key:"distance",value:function(t){var e=new Vector(this.size),n=t;if(n instanceof Vector&&(n=n.obj),n.length%this.size!=0)throw new Error(this.type+" can't be calculate distance with not compatible type");return this.forEach(function(t,i){e.obj[i]=n[i]-t}),e.length()}},{key:"dot",value:function(t){var e=(new Vector(this.size),t);if(e instanceof Vector&&(e=e.obj),e.length%this.size!=0)throw new Error(this.type+" can't be calculate dot with not compatible type");return this.reduce(function(t,n,i){return t+this.obj[i]*e[i]},0)}},{key:"length",value:function(){return Math.sqrt(this.reduce(function(t,e){return t+Math.pow(e,2)},0))}},{key:"normalize",value:function(){var t=new Vector(this.size),e=this.length();return e>0&&(e=1/e,this.forEach(function(n,i){t.obj[i]=n*e})),t}},{key:"rotate",value:function(){}},{key:"rotateX",value:function(){}},{key:"rotateY",value:function(){}},{key:"rotateZ",value:function(){}},{key:"obj",set:function(t){this._obj=t},get:function(){return this._obj}},{key:"size",get:function(){return this.obj.length}},{key:"type",get:function(){var t=this.size;return 1===t?"vec1":2===t?"vec2":3===t?"vec3":4===t?"vec4":void 0}},{key:"float32",get:function(){return new Float32Array(this.obj)}},{key:"int8",get:function(){return new Int8Array(this.obj)}},{key:"int16",get:function(){return new Int16Array(this.obj)}},{key:"uInt8",get:function(){return new Uint8Array(this.obj)}},{key:"uInt16",get:function(){return new Uint16Array(this.obj)}},{key:"array",get:function(){return this.obj.map(function(t){return t})}}]),Vector}();e.a=o},function(t,e,n){"use strict";var i=n(24),r=n(23);e.a={vs:{terrain:i.a},fs:{terrain:r.a}}},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var i=n(14),r=(n(1),n(4)),o=n(0),s=n(25),a=n(17);n.d(e,"LandScape",function(){return l});var u=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),c=["WEBGL_draw_buffers","OES_element_index_uint","ANGLE_instanced_arrays","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","EXT_frag_depth","OES_standard_derivatives","WEBGL_depth_texture","OES_vertex_array_object"],h={position:{x:0,y:0},layer:{x:0,y:0},state:{press:!1}},f={speed:.7},l=function(t){function LandScape(t,e){_classCallCheck(this,LandScape);var n=_possibleConstructorReturn(this,(LandScape.__proto__||Object.getPrototypeOf(LandScape)).call(this));n.options={heightMap:e},n.frameDispatcher=new i.a;var o=new r.a;c.forEach(function(t){o.addExtention(t)});var u=new a.a({near:1,far:80}),h=[0,0,0],l=[0,0,0];return o.appendTo(t),n.display=o,n.camera=u,n.camera.speed=f.speed,n.cameraVelocity=h,n.cameraAngleVelocity=l,n.loadSources().then(function(t){var e=new s.a({grid:{cols:512,rows:512},heightMap:t,primitives:this.options.heightMap.primitives});o.addObject("terrain",e),u.rotate([-5,125,5]),u.position=[24,13,1],this.draw(),this.frameDispatcher.callback=function(){var t=this.cameraAngleVelocity.some(function(t){return 0!==t}),e=this.cameraVelocity.some(function(t){return 0!==t});t&&u.rotate(this.cameraAngleVelocity),e&&u.translate(this.cameraVelocity),t&&t&&this.draw()}.bind(this),this.listenKeys()}.bind(n)),n}return _inherits(LandScape,t),u(LandScape,[{key:"loadSources",value:function(){var t=this;return new Promise(function(e,n){t.options.heightMap.texture={},t.options.heightMap.texture.img=new Image,t.options.heightMap.texture.img.addEventListener("load",function(){e(t.options.heightMap.texture.img)}),t.options.heightMap.texture.img.src=t.options.heightMap.src})}},{key:"listenKeys",value:function(){var t=this,e=this.cameraVelocity,n=this.cameraAngleVelocity,r=new i.a;r.callback=function(){n.forEach(function(t,e){var i=t;i>0?(i-=.009,i<0&&(i=0),n[e]=i):i<0&&(i+=.009,i>0&&(i=0),n[e]=i),n[e]=0}),n.every(function(t){return t<=0})&&r.stop()},window.addEventListener("keydown",function(n){switch(n.keyCode){case 87:e[2]=-t.camera.speed;break;case 83:e[2]=t.camera.speed}},!1),window.addEventListener("keyup",function(t){switch(t.keyCode){case 87:case 83:e[2]=0}},!1),this.display.canvas.context.addEventListener("mousemove",function(e){h.position.x=e.layerX-t.display.width/2,h.position.y=e.layerY-t.display.height/2,h.layer.x=e.layerX,h.layer.y=e.layerY,r.startIn(200),h.position.y>-t.display.height/2&&h.position.y<t.display.height/2&&h.position.x>-t.display.width/2&&h.position.x<t.display.width/2?t.cameraAngleVelocity[1]=-.0015*h.position.x:t.cameraAngleVelocity[0]=0})}},{key:"listenEvents",value:function(){}},{key:"resize",value:function(t,e){this.display.resize(t,e),this.display.canvas.resize(t,e),this.camera.ratio=t/e,this.draw()}},{key:"draw",value:function(){var t=this;t.display.clear(),t.display.objects.forEach(function(e){e.update(t.display,t.camera),e.draw()})}},{key:"isRun",value:function(){return this.frameDispatcher.isRun()}},{key:"start",value:function(){this.frameDispatcher.start()}},{key:"stop",value:function(){this.frameDispatcher.stop()}},{key:"frameDispatcher",set:function(t){this._frameDispatcher=t},get:function(){return this._frameDispatcher}}]),LandScape}(o.a)},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(3),r=function(t){function ArrayBuffer(t,e,n,i,r){return _classCallCheck(this,ArrayBuffer),_possibleConstructorReturn(this,(ArrayBuffer.__proto__||Object.getPrototypeOf(ArrayBuffer)).call(this,t,"ARRAY_BUFFER",e,n,i,r))}return _inherits(ArrayBuffer,t),ArrayBuffer}(i.a);e.a=r},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=(n(3),function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}()),o=function(t){function Attribute(t,e,n){_classCallCheck(this,Attribute);var i=_possibleConstructorReturn(this,(Attribute.__proto__||Object.getPrototypeOf(Attribute)).call(this));return i.name=t,e&&n&&i.link(e,n),i}return _inherits(Attribute,t),r(Attribute,[{key:"link",value:function(t,e){return this.gl!==t&&(this.gl=t,this.program=e,this.init(),this)}},{key:"init",value:function(){this.context=this.gl.getAttribLocation(this.program.context,this.name)}},{key:"use",value:function(t){return!!t&&(this.gl.bindBuffer(this.gl[t.bufferType],t.context),this.gl.enableVertexAttribArray(this.context),this.gl.vertexAttribPointer(this.context,t.size,this.gl.FLOAT,!1,0,0),!0)}},{key:"buffer",set:function(t){this._buffer=t},get:function(){return this._buffer}},{key:"name",set:function(t){return this._name=t},get:function(){return this._name}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"program",set:function(t){this._program=t},get:function(){return this._program}}]),Attribute}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(t){function Canvas(){_classCallCheck(this,Canvas);var t=_possibleConstructorReturn(this,(Canvas.__proto__||Object.getPrototypeOf(Canvas)).call(this));return t.context=document.createElement("canvas"),t.gl=t.context.getContext("webgl"),t}return _inherits(Canvas,t),r(Canvas,[{key:"resize",value:function(t,e){this.width=t,this.height=e,this.context.width=t,this.context.height=e}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"width",set:function(t){this._width=t},get:function(){return this._width}},{key:"height",set:function(t){this._height=t},get:function(){return this._height}}]),Canvas}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(3),r=function(t){function ElementArrayBuffer(t,e,n,i,r){return _classCallCheck(this,ElementArrayBuffer),_possibleConstructorReturn(this,(ElementArrayBuffer.__proto__||Object.getPrototypeOf(ElementArrayBuffer)).call(this,t,"ELEMENT_ARRAY_BUFFER",e,n,i,r))}return _inherits(ElementArrayBuffer,t),ElementArrayBuffer}(i.a);e.a=r},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(t){function FragmentShader(t,e,n){_classCallCheck(this,FragmentShader);var i=_possibleConstructorReturn(this,(FragmentShader.__proto__||Object.getPrototypeOf(FragmentShader)).call(this));return i.name=t,e&&n&&i.link(e,n),i}return _inherits(FragmentShader,t),r(FragmentShader,null,[{key:"type",get:function(){return"FRAGMENT_SHADER"}}]),r(FragmentShader,[{key:"link",value:function(t,e){return this.gl!==t&&(this.gl=t,this.program=e,this.init(),this)}},{key:"init",value:function(){this.context=this.gl.createShader(this.gl[FragmentShader.type]),this.gl.shaderSource(this.context,this.source.toString()),this.gl.compileShader(this.context)}},{key:"name",set:function(t){return this._name=t},get:function(){return this._name}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"source",set:function(t){this._source=t},get:function(){return this._source}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"program",set:function(t){this._program=t},get:function(){return this._program}}]),FragmentShader}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(){function FrameDispatcher(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};_classCallCheck(this,FrameDispatcher),this.callback=t,this.loop=this.create(),this.id=null;var e=new i.a;this.on=function(){e.on.apply(e,arguments)},this.off=function(){e.off.apply(e,arguments)},this.trigger=function(){e.trigger.apply(e,arguments)}}return r(FrameDispatcher,[{key:"create",value:function(){var t=function(){this.timer=new Date-this.startTime,this.callback(),this.reset?(this.timer=0,cancelAnimationFrame(this.id),this.id=null,this.reset=!1):this.id=requestAnimationFrame(t)}.bind(this);return t}},{key:"onceIn",value:function(t){var e=this;this._onceInTimer&&clearTimeout(this._onceInTimer),this._onceInTimer=setTimeout(function(){this.callback(),delete e._onceInTimer}.bind(this),t)}},{key:"startIn",value:function(t){var e=this;this._startInTimer&&clearTimeout(this._startInTimer),this._startInTimer=setTimeout(function(){this.start(),delete e._startInTimer}.bind(this),t)}},{key:"stopIn",value:function(t){var e=this;this._stopInTimer&&clearTimeout(this._stopInTimer),this._stopInTimer=setTimeout(function(){this.stop(),delete e._stopInTimer}.bind(this),t)}},{key:"stop",value:function(){this.reset=!0}},{key:"isRun",value:function(){return!!this.id}},{key:"start",value:function(){this.startTime=new Date,this.loop=this.create(),this.loop()}},{key:"timer",set:function(t){this._timer=t},get:function(){return this._timer}},{key:"startTime",set:function(t){this._startTime=t},get:function(){return this._startTime}},{key:"reset",set:function(t){this._reset=t},get:function(){return this._reset}},{key:"callback",set:function(t){this._callback=t},get:function(){return this._callback}},{key:"loop",set:function(t){this._loop=t},get:function(){return this._loop}},{key:"id",set:function(t){this._id=t},get:function(){return this._id}}]),FrameDispatcher}();e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=n(1),o=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),s=function(t){function Geometry(){_classCallCheck(this,Geometry);var t=_possibleConstructorReturn(this,(Geometry.__proto__||Object.getPrototypeOf(Geometry)).call(this));return t.options=Geometry.getDefaultOptions(),t.programs=new Map,t.objects=new Map,t.matrices=new Map,t.buffers=new Map,t.addMatrix("model",new r.a(16)),t}return _inherits(Geometry,t),o(Geometry,null,[{key:"getDefaultOptions",value:function(){return{}}}]),o(Geometry,[{key:"addObject",value:function(t,e){this.objects.set(t,e)}},{key:"removeObjects",value:function(t){this.objects.remove(t)}},{key:"hideObject",value:function(t){return!!this.objects.get(t)&&(this.objects.get(t).options.visible=!1,!0)}},{key:"showObjects",value:function(t){return!!this.objects.get(t)&&(this.objects.get(t).options.visible=!1,!0)}},{key:"addProgram",value:function(t,e){this.programs.set(t,e),this.gl&&e.link(this.gl)}},{key:"getProgram",value:function(t){return this.programs.get(t)}},{key:"removeProgram",value:function(t){this.programs.remove(t)}},{key:"addMatrix",value:function(t,e){this.matrices.set(t,e)}},{key:"addBuffer",value:function(t,e){this.buffers.set(t,e)}},{key:"getBuffer",value:function(t){return this.buffers.get(t)}},{key:"removeBuffer",value:function(t){this.buffers.remove(t)}},{key:"getMatrix",value:function(t){return this.matrices.get(t)}},{key:"removeMatrix",value:function(t){this.matrices.remove(t)}},{key:"setMatrix",value:function(t,e){this.matrices.set(t,e)}},{key:"update",value:function(t,e){this.setMatrix("projection",e.getMatrix("projection")),this.setMatrix("view",e.getMatrix("view")),this.setMatrix("normal",e.getMatrix("normal")),this.link(t),this.objects.forEach(function(n){n.update(t,e)})}},{key:"link",value:function(t,e){this.gl=t.gl,this.buffers.forEach(function(e){e.link(t.gl)}),this.programs.forEach(function(e){e.link(t.gl)}),e&&this.programs.forEach(function(e){t.programs.get(e.name)||t.addProgram(e.name,e)})}},{key:"transform",value:function(t){var e=t.multiply(this.getMatrix("model"));this.setMatrix("model",e),this.objects.forEach(function(t){t.transform(e)})}},{key:"rotate",value:function(t){var e=this.getMatrix("model");this.setMatrix("model",e.rotate(t))}},{key:"translate",value:function(t){var e=this.getMatrix("model");this.setMatrix("model",e.translate(t))}},{key:"draw",value:function(t){return!!this.gl&&(this.objects.forEach(function(e){e.draw(t)}),!0)}},{key:"buffers",set:function(t){this._buffers=t},get:function(){return this._buffers}},{key:"position",get:function(){return this._position},set:function(t){var e=new r.a(16);e.obj[12]=t[0],e.obj[13]=t[1],e.obj[14]=t[2],this.transform(e),this._position=t}},{key:"options",set:function(t){this._options=t},get:function(){return this._options}},{key:"objects",set:function(t){this._objects=t},get:function(){return this._objects}},{key:"programs",get:function(){return this._programs},set:function(t){this._programs=t}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"display",set:function(t){this._display=t},get:function(){return this._display}},{key:"matrices",set:function(t){this._matrices=t},get:function(){return this._matrices}}]),Geometry}(i.a);e.a=s},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(1),r=(n(6),function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}()),o=function(){function Quaternion(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;_classCallCheck(this,Quaternion),this.obj=t instanceof Array?t.concat([]):new Array(t-1).fill(0).concat(1)}return r(Quaternion,[{key:"forEach",value:function(t){this.obj.forEach(t.bind(this))}},{key:"map",value:function(t){return this.obj.map(t.bind(this))}},{key:"filter",value:function(t){return this.obj.filter(t.bind(this))}},{key:"reduce",value:function(t,e){return void 0!==e?this.obj.reduce(t.bind(this),e):this.obj.reduce(t.bind(this))}},{key:"multiply",value:function(t){var e=new Quaternion(this.size),n=t;if(n instanceof Quaternion&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be add with not compatible type");e.obj[0]=this.obj[0]*n[3]+this.obj[3]*n[0]+this.obj[1]*n[2]-this.obj[2]*n[1],e.obj[1]=this.obj[1]*n[3]+this.obj[3]*n[1]+this.obj[2]*n[0]-this.obj[0]*n[2],e.obj[2]=this.obj[2]*n[3]+this.obj[3]*n[2]+this.obj[0]*n[1]-this.obj[1]*n[0],e.obj[3]=this.obj[3]*n[3]-this.obj[0]*n[0]-this.obj[1]*n[1]-this.obj[2]*n[2]}else"number"==typeof n&&this.forEach(function(t,i){e.obj[i]=t+n});return e}},{key:"getAxisAngle",value:function(){var t=new Array(this.size).fill(0),e=2*Math.acos(this.obj[3]),n=Math.sin(e/2);return 0!=n?(t[0]=this.obj[0]/n,t[1]=this.obj[1]/n,t[2]=this.obj[2]/n):(t[0]=1,t[1]=0,t[2]=0),t[3]=0,t.angle=e,[t,e]}},{key:"setAxisAngle",value:function(t,e){var n=new Quaternion(this.size),i=.5*e,r=Math.sin(i);return n.obj[0]=r*t[0],n.obj[1]=r*t[1],n.obj[2]=r*t[2],n.obj[3]=Math.cos(i),n}},{key:"add",value:function(t){var e=new Quaternion(this.size),n=t;if(n instanceof Quaternion&&(n=n.obj),n instanceof Array){if(n.length%this.size!=0)throw new Error(this.type+" can't be add with not compatible type");this.forEach(function(t,i){e.obj[i]=t+n[i]})}else"number"==typeof n&&this.forEach(function(t,i){e.obj[i]=t+n});return e}},{key:"rotateX",value:function(t){var e=new Quaternion(this.size),n=.5*t,i=Math.sin(n),r=Math.cos(n);return e.obj[0]=this.obj[0]*r+this.obj[3]*i,e.obj[1]=this.obj[1]*r+this.obj[2]*i,e.obj[2]=this.obj[2]*r-this.obj[1]*i,e.obj[3]=this.obj[3]*r-this.obj[0]*i,e}},{key:"rotateY",value:function(t){var e=new Quaternion(this.size),n=.5*t,i=Math.sin(n),r=Math.cos(n);return e.obj[0]=this.obj[0]*r-this.obj[2]*i,e.obj[1]=this.obj[1]*r+this.obj[3]*i,e.obj[2]=this.obj[2]*r+this.obj[0]*i,e.obj[3]=this.obj[3]*r-this.obj[1]*i,e}},{key:"rotateZ",value:function(t){var e=new Quaternion(this.size),n=.5*t,i=Math.sin(n),r=Math.cos(n);return e.obj[0]=this.obj[0]*r+this.obj[1]*i,e.obj[1]=this.obj[1]*r-this.obj[0]*i,e.obj[2]=this.obj[2]*r+this.obj[3]*i,e.obj[3]=this.obj[3]*r-this.obj[2]*i,e}},{key:"rotate",value:function(){new Quaternion(this.size)}},{key:"dot",value:function(t){var e=(new Quaternion(this.size),t);if(e instanceof Quaternion&&(e=e.obj),e.length%this.size!=0)throw new Error(this.type+" can't be calculate dot with not compatible type");return this.reduce(function(t,n,i){return t+this.obj[i]*e[i]},0)}},{key:"inverse",value:function(){var t=new Quaternion(this.size),e=this.dot(this),n=e?1/e:0;return t.obj[0]=-this.obj[0]*n,t.obj[1]=-this.obj[1]*n,t.obj[2]=-this.obj[2]*n,t.obj[3]=this.obj[3]*n,t}},{key:"length",value:function(){return Math.sqrt(this.reduce(function(t,e){return t+Math.pow(e,2)},0))}},{key:"normalize",value:function(){var t=new Quaternion(this.size),e=this.length();return e>0&&(e=1/e,this.forEach(function(n,i){t.obj[i]=n*e})),t}},{key:"obj",set:function(t){this._obj=t},get:function(){return this._obj}},{key:"matrix",set:function(t){var e=new Quaternion(4),n=t;n instanceof i.a&&(n=t.obj);var r=Math.sqrt(n.length);if(3!==r&&4!==r)throw new Error("Can't be created qauternion from not compatible matrix type");4===r&&(n=[n[0],n[1],n[2],n[4],n[5],n[6],n[8],n[9],n[10]]);var o=n[0]+n[4]+n[8],s=void 0;if(o>0)s=Math.sqrt(o+1),e.obj[3]=.5*s,s=.5/s,e.obj[0]=(n[5]-n[7])*s,e.obj[1]=(n[6]-n[2])*s,e.obj[2]=(n[1]-n[3])*s;else{var a=0;n[4]>n[0]&&(a=1),n[8]>n[3*a+a]&&(a=2);var u=(a+1)%3,c=(a+2)%3;s=Math.sqrt(n[3*a+a]-n[3*u+u]-n[3*c+c]+1),e.obj[a]=.5*s,s=.5/s,e.obj[3]=(n[3*u+c]-n[3*c+u])*s,e.obj[u]=(n[3*u+a]+n[3*a+u])*s,e.obj[c]=(n[3*c+a]+n[3*a+c])*s}return e}},{key:"size",get:function(){return this.obj.length}},{key:"float32",get:function(){return new Float32Array(this.obj)}},{key:"int8",get:function(){return new Int8Array(this.obj)}},{key:"int16",get:function(){return new Int16Array(this.obj)}},{key:"uInt8",get:function(){return new Uint8Array(this.obj)}},{key:"uInt16",get:function(){return new Uint16Array(this.obj)}}]),Quaternion}();e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=n(1),o=n(2),s=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),a=function(t){function TrakingCamera(t){_classCallCheck(this,TrakingCamera);var e=_possibleConstructorReturn(this,(TrakingCamera.__proto__||Object.getPrototypeOf(TrakingCamera)).call(this));return e.options=o.a.merge(TrakingCamera.getDefaultOptions(),t),e.matrices=new Map,e.addMatrix("model",new r.a(16)),e.addMatrix("projection",new r.a(16).perspective(1,1,e.options.near,e.options.far)),e.addMatrix("view",e.getMatrix("model").inverse()),e.ratio=1,e.fovy=o.a.rad(58),e.position=[0,0,0],e}return _inherits(TrakingCamera,t),s(TrakingCamera,null,[{key:"getDefaultOptions",value:function(){return{near:1e-5,far:1e7}}}]),s(TrakingCamera,[{key:"addMatrix",value:function(t,e){this.matrices.set(t,e)}},{key:"getMatrix",value:function(t){return this.matrices.get(t)}},{key:"removeMatrix",value:function(t){this.matrices.remove(t)}},{key:"setMatrix",value:function(t,e){this.matrices.set(t,e)}},{key:"translate",value:function(t){var e=this.getMatrix("model");e=e.translate(t),this.setMatrix("model",e),this.setMatrix("view",e.inverse())}},{key:"rotate",value:function(t){var e=this.getMatrix("model");e=e.rotate(t),this.setMatrix("model",e),this.setMatrix("view",e.inverse())}},{key:"position",set:function(t){var e=this.getMatrix("model");e.obj[12]=t[0],e.obj[13]=t[1],e.obj[14]=t[2],this._position=t,this.setMatrix("model",e),this.setMatrix("view",this.getMatrix("model").inverse())},get:function(){return this._position}},{key:"ratio",get:function(){return this._ratio},set:function(t){this.setMatrix("projection",new r.a(16).perspective(this.fovy||1,t,this.options.near,this.options.far)),this._ratio=t}},{key:"fovy",get:function(){return this._fovy},set:function(t){this.setMatrix("projection",new r.a(16).perspective(t,this.ratio||1,this.options.near,this.options.far)),this._fovy=t}},{key:"fovx",get:function(){return 2*Math.atan(Math.tan(this.fovy/2)*this.ratio)}},{key:"matrices",set:function(t){this._matrices=t},get:function(){return this._matrices}}]),TrakingCamera}(i.a);e.a=a},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(t){function Uniform(t,e,n,i){_classCallCheck(this,Uniform);var r=_possibleConstructorReturn(this,(Uniform.__proto__||Object.getPrototypeOf(Uniform)).call(this));return r.name=t,r.type=e,n&&i&&r.link(n,i),r}return _inherits(Uniform,t),r(Uniform,[{key:"link",value:function(t,e){return this.gl!==t&&(this.gl=t,this.program=e,this.init(),this)}},{key:"init",value:function(){this.context=this.gl.getUniformLocation(this.program.context,this.name)}},{key:"setData",value:function(t){var e=t;switch(this.type){case"mat4":this.gl.uniformMatrix4fv(this.context,this.gl.FALSE,e);break;case"3fv":case"4fv":case"1f":case"1fv":case"1i":case"1iv":this.gl["uniform"+this.type](this.context,e)}}},{key:"name",set:function(t){return this._name=t},get:function(){return this._name}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"type",set:function(t){this._type=t},get:function(){return this._type}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"program",set:function(t){this._program=t},get:function(){return this._program}}]),Uniform}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(0),r=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),o=function(t){function VertexShader(t,e,n){_classCallCheck(this,VertexShader);var i=_possibleConstructorReturn(this,(VertexShader.__proto__||Object.getPrototypeOf(VertexShader)).call(this));return i.name=t,e&&n&&i.link(e,n),i}return _inherits(VertexShader,t),r(VertexShader,null,[{key:"type",get:function(){return"VERTEX_SHADER"}}]),r(VertexShader,[{key:"link",value:function(t,e){return this.gl!==t&&(this.gl=t,this.program=e,this.init(),this)}},{key:"init",value:function(){this.context=this.gl.createShader(this.gl[VertexShader.type]),this.gl.shaderSource(this.context,this.source.toString()),this.gl.compileShader(this.context)}},{key:"name",set:function(t){return this._name=t},get:function(){return this._name}},{key:"context",set:function(t){this._context=t},get:function(){return this._context}},{key:"source",set:function(t){this._source=t},get:function(){return this._source}},{key:"gl",set:function(t){this._gl=t},get:function(){return this._gl}},{key:"program",set:function(t){this._program=t},get:function(){return this._program}}]),VertexShader}(i.a);e.a=o},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(5),r=n(18),o=n(10),s=n(22),a=n(21),u=function(t){function TerrainProgram(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"TerrainProgram",e=arguments[1];_classCallCheck(this,TerrainProgram);var n=_possibleConstructorReturn(this,(TerrainProgram.__proto__||Object.getPrototypeOf(TerrainProgram)).call(this,t,e));return n.addUniform("uM",new r.a("uM","mat4")),n.addUniform("uV",new r.a("uV","mat4")),n.addUniform("uP",new r.a("uP","mat4")),n.addUniform("uScale",new r.a("uScale","1fv")),n.addUniform("uHeightMap",new r.a("uHeightMap","1i")),n.addAttribute("aVertexPosition",new o.a("aVertexPosition")),n.addAttribute("aUVs",new o.a("aUVs")),n.addShader("vs",new s.a),n.addShader("fs",new a.a),n}return _inherits(TerrainProgram,t),TerrainProgram}(i.a);e.a=u},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(13),r=n(7),o=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),s=function(t){function TerrainFS(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"TerrainFS",e=arguments[1],n=arguments[2];_classCallCheck(this,TerrainFS);var i=_possibleConstructorReturn(this,(TerrainFS.__proto__||Object.getPrototypeOf(TerrainFS)).call(this,t,e,n));return i.source=TerrainFS.getDefaultSource(),i}return _inherits(TerrainFS,t),o(TerrainFS,null,[{key:"getDefaultSource",value:function(){return r.a.fs.terrain}}]),TerrainFS}(i.a);e.a=s},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(19),r=n(7),o=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),s=function(t){function TerrianVS(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"TerrianVS",e=arguments[1],n=arguments[2];_classCallCheck(this,TerrianVS);var i=_possibleConstructorReturn(this,(TerrianVS.__proto__||Object.getPrototypeOf(TerrianVS)).call(this,t,e,n));return i.source=TerrianVS.getDefaultSource(),i}return _inherits(TerrianVS,t),o(TerrianVS,null,[{key:"getDefaultSource",value:function(){return r.a.vs.terrain}}]),TerrianVS}(i.a);e.a=s},function(t,e,n){"use strict";e.a="         precision highp float;\n     precision highp int;\n   uniform sampler2D uHeightMap;  varying vec2 vUVs;   vec3 HDR(vec3 L, float a) {\n     L = L * a;\n     L.r = L.r < 1.413 ? pow(L.r * 0.38317, 1.0 / 2.2) : 1.0 - exp(-L.r);\n     L.g = L.g < 1.413 ? pow(L.g * 0.38317, 1.0 / 2.2) : 1.0 - exp(-L.g);\n     L.b = L.b < 1.413 ? pow(L.b * 0.38317, 1.0 / 2.2) : 1.0 - exp(-L.b);\n     return L;\n }\n   void main(void){\n            gl_FragColor = vec4(vec3(244.0/255.0),1.0);\n }"},function(t,e,n){"use strict";e.a="    precision highp float;\n    precision highp int;\n            attribute highp vec3 aVertexPosition;\n    attribute highp vec2 aUVs;\n            uniform mat4 uM;\n    uniform mat4 uP;\n    uniform mat4 uV;\n            uniform sampler2D uHeightMap;            varying vec2 vUVs;    void main(){\n            vec3 position = aVertexPosition.xyz;        float elevation = texture2D(uHeightMap,aUVs).x;    position.y = elevation*35.0;        vec4 pos = uP*uV*uM*vec4(position.xyz,1.0);    vUVs = aUVs;    gl_Position = pos;\n    gl_PointSize = 1.7;}"},function(t,e,n){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var i=n(9),r=n(12),o=n(15),s=(n(4),n(20)),a=n(2),u=function get(t,e,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,e);if(void 0===i){var r=Object.getPrototypeOf(t);return null===r?void 0:get(r,e,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},c=function(){function defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,n){return e&&defineProperties(t.prototype,e),n&&defineProperties(t,n),t}}(),h=function(t){function Terrain(t){_classCallCheck(this,Terrain);var e=_possibleConstructorReturn(this,(Terrain.__proto__||Object.getPrototypeOf(Terrain)).call(this));e.options=a.a.merge(Terrain.getDefaultOptions(),t),e.position=[0,0,0];var n=64,o=a.a.generateGrid(t.grid.cols,t.grid.rows),u=o.vertices.reduce(function(t,e,i){return i%2==0?t.push(e*n):t.push(0,e*n),t},[]);return e.addProgram("terrain",new s.a),e.addBuffer("indices",new r.a("indices","STATIC_DRAW",1,new Uint32Array(o.indices))),e.addBuffer("aVertexPosition",new i.a("aVertexPosition","STATIC_DRAW",3,new Float32Array(u))),e.addBuffer("aUVs",new i.a("aUVs","STATIC_DRAW",2,new Float32Array(o.uv))),e}return _inherits(Terrain,t),c(Terrain,null,[{key:"getDefaultOptions",value:function(){return{scale:55}}}]),c(Terrain,[{key:"createTexture",value:function(t,e,n,i){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.FLOAT,i),t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,null),r}},{key:"update",value:function(t,e){this.setMatrix("projection",e.getMatrix("projection")),this.setMatrix("view",e.getMatrix("view")),this.link(t)}},{key:"transform",value:function(t){u(Terrain.prototype.__proto__||Object.getPrototypeOf(Terrain.prototype),"transform",this).call(this,t)}},{key:"draw",value:function(t){var e=this,n=this.gl,i=this.getProgram("terrain");this.heightTexture||(this.heightTexture=this.createTexture(this.gl,this.options.heightMap.width,this.options.heightMap.height,this.options.heightMap,!1,!1,!1,!0)),i.use(),n.enable(n.DEPTH_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),n.frontFace(n.CCW),i.getAttribute("aVertexPosition").use(this.buffers.get("aVertexPosition")),i.getAttribute("aUVs").use(this.buffers.get("aUVs")),i.getUniform("uM").setData(e.getMatrix("model").obj),i.getUniform("uV").setData(e.getMatrix("view").obj),i.getUniform("uP").setData(e.getMatrix("projection").obj),e.heightTexture&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,e.heightTexture)),i.getUniform("uHeightMap").setData(0),n.bindBuffer(n[this.buffers.get("indices").bufferType],this.buffers.get("indices").context),n.drawElements(n[this.options.primitives],this.buffers.get("indices").data.length,n.UNSIGNED_INT,0)}},{key:"heightmap",set:function(t){this._heightmap=t},get:function(){return this._heightmap}}]),Terrain}(o.a);e.a=h},function(t,e,n){t.exports=n(8)}])});
//# sourceMappingURL=terrain.min.js.map